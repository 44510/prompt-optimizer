# 双版本显示功能实现

## 功能概述

实现了同时显示最新正式版和最新预览版的功能，用户可以在两种版本之间快速切换查看，并选择下载合适的版本。

## 实现方案

### 方案选择：智能切换显示

选择了智能切换显示方案而不是同时显示两个版本，原因：
- **界面简洁**：避免界面过于复杂，减少用户困惑
- **实现简单**：最小化代码修改，降低风险
- **用户体验**：提供快速切换功能，满足查看不同版本的需求

## 技术实现

### 1. 数据结构扩展

扩展了`UpdaterState`接口：
```typescript
export interface UpdaterState {
  // 现有字段...
  
  // 新增字段
  currentViewMode: 'stable' | 'prerelease'
  stableVersion: string | null
  stableReleaseUrl: string | null
  prereleaseVersion: string | null
  prereleaseReleaseUrl: string | null
}
```

### 2. 双重检查逻辑

实现了`checkBothVersions()`函数：
1. 先检查正式版本（allowPrerelease=false）
2. 再检查预览版本（allowPrerelease=true）
3. 保存两种版本的信息
4. 根据当前查看模式更新显示

### 3. 版本切换功能

添加了`switchViewMode()`函数：
- 在正式版和预览版之间切换
- 自动更新显示的版本信息
- 重新计算是否有更新可用

### 4. UI界面改进

#### 版本信息显示
- 显示当前查看的版本类型（正式版/预览版）
- 添加版本类型标签（绿色正式版，橙色预览版）
- 提供快速切换按钮

#### 版本对比信息
- 当两种版本都存在且不同时，显示版本对比信息
- 在底部显示正式版和预览版的版本号

## 用户界面变化

### 版本信息区域
```
┌─────────────────────────────────────────┐
│ 最新正式版 [正式版] [查看预览版] [GitHub] │
│ v1.2.0                                  │
│ ─────────────────────────────────────── │
│ 正式版: v1.2.0  预览版: v1.3.0-beta.1   │
└─────────────────────────────────────────┘
```

### 交互流程
1. **初始状态**：默认显示正式版信息
2. **切换查看**：点击"查看预览版"按钮切换到预览版
3. **版本对比**：底部显示两种版本的对比信息
4. **下载选择**：用户可以选择下载当前查看的版本

## 国际化支持

添加了新的翻译键：
- `latestStableVersion`: 最新正式版
- `latestPrereleaseVersion`: 最新预览版
- `stable`: 正式版
- `prerelease`: 预览版
- `viewStable`: 查看正式版
- `viewPrerelease`: 查看预览版

## API变化

### useUpdater Composable
新增返回值：
```typescript
return {
  // 现有API...
  switchViewMode  // 新增：切换版本查看模式
}
```

### 状态管理
- `currentViewMode`: 当前查看模式
- `stableVersion`: 最新正式版版本号
- `prereleaseVersion`: 最新预览版版本号
- 对应的发布页面URL

## 兼容性

### 向后兼容
- 保持现有API不变
- 默认显示正式版，与原有行为一致
- 非Electron环境正常工作

### 错误处理
- 网络错误时优雅降级
- 版本检查失败时显示错误信息
- 保持原有的错误处理机制

## 使用场景

### 开发者
- 可以快速查看最新的预览版功能
- 在正式版和预览版之间做出选择
- 了解版本发布节奏

### 普通用户
- 默认看到稳定的正式版
- 可选择体验预览版新功能
- 清楚了解版本类型和风险

## 后续优化建议

1. **缓存机制**：缓存版本检查结果，减少重复请求
2. **自动刷新**：定期自动检查新版本
3. **版本历史**：显示版本更新历史和变更日志
4. **下载进度**：改进下载进度显示
5. **通知系统**：新版本可用时的桌面通知

## 测试建议

1. **功能测试**：验证版本切换和显示功能
2. **网络测试**：测试网络异常情况的处理
3. **兼容性测试**：确保在不同环境下正常工作
4. **用户体验测试**：收集用户对新界面的反馈
